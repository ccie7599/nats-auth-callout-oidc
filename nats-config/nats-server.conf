# NATS Server - Auth Callout with OIDC
server_name: nats-auth-demo

listen: 0.0.0.0:4222

# Monitoring
http_port: 8222

# TLS for client connections
tls {
  cert_file: /certs/fullchain.pem
  key_file: /certs/privkey.pem
}

# WebSocket listener (TLS)
websocket {
  port: 8443
  tls {
    cert_file: /certs/fullchain.pem
    key_file: /certs/privkey.pem
  }
  allowed_origins: ["https://nats-demo.connected-cloud.io"]
  compression: true
}

# Account definitions
accounts {
  AUTH: {
    users: [
      { user: "auth-service", password: $AUTH_SERVICE_PASSWORD }
    ]
  }
  APP: {}
  SYS: {}
}

system_account: SYS

# Auth callout configuration
authorization {
  auth_callout {
    issuer: $NKEY_PUBLIC
    account: AUTH
    auth_users: ["auth-service"]
  }
}

# Logging
logtime: true
debug: true
trace: false
